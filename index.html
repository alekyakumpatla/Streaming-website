<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamVibe - Working Telugu Player</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-black: #000000;
            --bg-dark: #121212;
            --bg-light: #242424;
            --primary: #ff9f00; /* Telugu Orange */
            --text-white: #ffffff;
            --text-gray: #b3b3b3;
            --sidebar-width: 240px;
            --player-height: 90px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-black);
            color: var(--text-white);
            height: 100vh;
            overflow: hidden;
        }

        /* --- LOGIN PAGE --- */
        #login-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #1a0b00 0%, #000000 100%);
            display: flex; justify-content: center; align-items: center;
            z-index: 9999; flex-direction: column;
        }

        .login-box {
            background-color: #181818; padding: 40px; border-radius: 12px;
            width: 100%; max-width: 400px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #333;
        }

        .login-logo { font-size: 40px; font-weight: 800; color: white; margin-bottom: 10px; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .login-logo i { color: var(--primary); }
        .login-sub { color: var(--text-gray); margin-bottom: 30px; font-size: 14px; }

        .input-group { margin-bottom: 20px; text-align: left; }
        .input-group label { display: block; font-size: 12px; font-weight: 700; margin-bottom: 5px; text-transform: uppercase; }
        .input-group input {
            width: 100%; padding: 12px; border-radius: 4px; border: 1px solid #333;
            background: #2a2a2a; color: white; font-family: inherit; outline: none;
        }
        .input-group input:focus { border-color: var(--primary); }

        .btn-login {
            width: 100%; padding: 14px; border: none; border-radius: 50px;
            background-color: var(--primary); color: black; font-weight: 800;
            font-size: 16px; cursor: pointer; transition: 0.3s;
        }
        .btn-login:hover { transform: scale(1.02); background-color: #ffb84d; }

        .divider { height: 1px; background: #333; margin: 25px 0; }
        
        /* --- MAIN APP --- */
        #app-container { display: none; height: 100%; width: 100%; flex-direction: column; }
        .content-wrapper { display: flex; height: calc(100vh - var(--player-height)); width: 100%; }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width); background-color: #000; padding: 24px;
            display: flex; flex-direction: column; gap: 20px; border-right: 1px solid #282828;
        }
        .app-logo { font-size: 24px; font-weight: 800; color: white; display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
        .app-logo i { color: var(--primary); }
        
        .nav-item {
            display: flex; align-items: center; gap: 15px; color: var(--text-gray);
            font-weight: 600; cursor: pointer; padding: 10px; border-radius: 5px; transition: 0.2s;
        }
        .nav-item:hover, .nav-item.active { color: white; background-color: #282828; }
        .nav-item i { width: 25px; text-align: center; }

        .playlist-scroll { overflow-y: auto; flex: 1; display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .playlist-item { color: var(--text-gray); cursor: pointer; font-size: 14px; }
        .playlist-item:hover { color: white; }

        /* Main Content */
        .main-content {
            flex: 1; background-color: var(--bg-dark);
            overflow-y: auto; background: linear-gradient(180deg, #1a1005 0%, var(--bg-dark) 50%);
        }

        header {
            position: sticky; top: 0; background-color: rgba(18,18,18,0.9);
            padding: 16px 32px; display: flex; justify-content: space-between; align-items: center; z-index: 100;
        }

        h2 { font-size: 24px; margin-bottom: 20px; font-weight: 700; padding: 0 32px; }
        h3 { font-size: 18px; margin-bottom: 15px; font-weight: 600; padding: 0 32px; }

        /* Cards */
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 20px; margin-bottom: 30px; padding: 0 32px; }
        .card { background-color: #181818; padding: 16px; border-radius: 6px; cursor: pointer; transition: 0.3s; position: relative; }
        .card:hover { background-color: #282828; }
        
        .card-img-wrapper { position: relative; aspect-ratio: 1; margin-bottom: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.4); border-radius: 4px; overflow: hidden; }
        .card-img { width: 100%; height: 100%; object-fit: cover; }
        
        .play-btn-overlay {
            position: absolute; bottom: 8px; right: 8px;
            width: 40px; height: 40px; border-radius: 50%;
            background-color: var(--primary); color: black;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; transform: translateY(10px); transition: 0.3s; font-size: 16px;
        }
        .card:hover .play-btn-overlay { opacity: 1; transform: translateY(0); }

        .card-title { font-weight: 700; font-size: 15px; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-desc { font-size: 13px; color: var(--text-gray); }

        /* Song List */
        .song-row {
            display: grid; grid-template-columns: 40px 1fr 1fr 50px;
            align-items: center; padding: 12px 32px;
            border-radius: 4px; color: var(--text-gray); font-size: 14px; cursor: pointer;
        }
        .song-row:hover { background-color: rgba(255,255,255,0.1); color: white; }
        .song-info { display: flex; align-items: center; gap: 15px; }
        .song-info img { width: 40px; height: 40px; border-radius: 4px; }
        
        /* Player Bar */
        .player-bar {
            height: var(--player-height); background-color: #181818;
            border-top: 1px solid #282828; padding: 0 20px;
            display: flex; justify-content: space-between; align-items: center; z-index: 200;
        }
        .track-info { display: flex; align-items: center; gap: 15px; width: 25%; }
        .track-art { width: 60px; height: 60px; border-radius: 4px; overflow: hidden; position: relative; }
        .track-art img { width: 100%; height: 100%; object-fit: cover; }
        
        .player-controls { display: flex; flex-direction: column; align-items: center; width: 45%; gap: 8px; }
        .control-buttons { display: flex; align-items: center; gap: 25px; }
        .control-btn { background: none; border: none; color: var(--text-gray); font-size: 16px; cursor: pointer; }
        .control-btn:hover { color: white; }
        
        .btn-play-pause {
            width: 35px; height: 35px; border-radius: 50%;
            background-color: white; color: black;
            display: flex; align-items: center; justify-content: center;
            font-size: 14px; cursor: pointer; transition: 0.2s;
        }
        .btn-play-pause:hover { transform: scale(1.1); }

        .progress-container { width: 100%; display: flex; align-items: center; gap: 10px; font-size: 11px; color: var(--text-gray); }
        .progress-bar-wrapper {
            flex: 1; height: 5px; background-color: #555; border-radius: 2px; cursor: pointer; position: relative;
        }
        .progress-fill { height: 100%; background-color: white; border-radius: 2px; width: 0%; transition: width 0.1s linear; }
        .progress-bar-wrapper:hover .progress-fill { background-color: var(--primary); }

        .volume-controls { width: 25%; display: flex; justify-content: flex-end; align-items: center; gap: 15px; }
        .volume-bar { width: 100px; height: 5px; background-color: #555; border-radius: 2px; cursor: pointer; }
        .volume-fill { width: 80%; height: 100%; background-color: white; border-radius: 2px; }

        /* Search */
        .search-input {
            width: 250px; padding: 10px 40px; border-radius: 20px;
            border: none; font-size: 14px; background: white; color: black;
        }
        .search-wrapper { position: relative; }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: black; }

        .toast {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
            background-color: var(--primary); color: black; font-weight: bold;
            padding: 12px 24px; border-radius: 30px; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 5000;
        }
        .toast.show { opacity: 1; bottom: 110px; }

        /* Sections */
        .view-section { display: none; padding: 20px 0; animation: fadeIn 0.4s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .warning-tag {
            background: #333; color: #aaa; padding: 5px 10px; border-radius: 4px; font-size: 10px; margin-left: 10px; text-transform: uppercase; letter-spacing: 1px;
        }

        /* --- VIDEO OVERLAY --- */
        #video-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.95); z-index: 10000;
            display: none; justify-content: center; align-items: center; flex-direction: column;
        }
        
        #video-container {
            width: 80%; max-width: 1000px; aspect-ratio: 16/9;
            background: black; box-shadow: 0 0 50px rgba(255, 159, 0, 0.2);
            border: 1px solid #333;
            position: relative;
        }

        video { width: 100%; height: 100%; object-fit: contain; }

        .video-controls-bar {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            padding: 20px; display: flex; justify-content: space-between; align-items: center;
            opacity: 0; transition: 0.3s;
        }
        #video-container:hover .video-controls-bar { opacity: 1; }

        .btn-close-video {
            position: absolute; top: 20px; right: 20px; z-index: 10001;
            background: rgba(255,255,255,0.1); color: white; border: none;
            width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 20px;
        }
        .btn-close-video:hover { background: white; color: black; }

        .video-btn {
            background: none; border: none; color: white; font-size: 24px; cursor: pointer;
        }

    </style>
</head>
<body>

    <!-- LOGIN PAGE -->
    <div id="login-page">
        <div class="login-box">
            <div class="login-logo">
                <i class="fas fa-compact-disc"></i> StreamVibe
            </div>
            <p class="login-sub">Guaranteed Working Player</p>
            
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="input-group">
                    <label>Email address</label>
                    <input type="email" id="email" placeholder="name@example.com" required>
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="password" placeholder="Password" required>
                </div>
                
                <button type="submit" class="btn-login">LOG IN</button>
            </form>
            <div class="divider"></div>
            <p style="font-size:12px; color:#777;">Click Login to enter</p>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app-container">
        <div class="content-wrapper">
            <!-- Sidebar -->
            <nav class="sidebar">
                <div class="app-logo">
                    <i class="fas fa-compact-disc"></i>
                    <span>StreamVibe</span>
                </div>
                <ul style="list-style: none; display: flex; flex-direction: column; gap: 5px;">
                    <li class="nav-item active" onclick="navigate('home')">
                        <i class="fas fa-home"></i> Home
                    </li>
                    <li class="nav-item" onclick="navigate('search')">
                        <i class="fas fa-search"></i> Search
                    </li>
                    <li class="nav-item" onclick="navigate('library')">
                        <i class="fas fa-music"></i> Library
                    </li>
                </ul>
                <h4 style="color:white; font-size: 12px; text-transform: uppercase; margin-top:20px;">Your Playlists</h4>
                <div class="playlist-scroll" id="playlist-container"></div>
            </nav>

            <!-- Main Content -->
            <main class="main-content">
                <header>
                    <div style="display: flex; gap: 10px;">
                        <button style="background: rgba(0,0,0,0.5); border:none; width:32px; height:32px; border-radius:50%; color:white;"><i class="fas fa-chevron-left"></i></button>
                        <button style="background: rgba(0,0,0,0.5); border:none; width:32px; height:32px; border-radius:50%; color:white;"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <div class="user-profile" id="user-profile-display" style="display:none; align-items:center; gap:10px;">
                        <span style="font-size:14px; font-weight:bold;">User</span>
                        <div style="width:30px; height:30px; background:#555; border-radius:50%; overflow:hidden;">
                            <img src="https://picsum.photos/seed/user/30/30" alt="User">
                        </div>
                    </div>
                </header>

                <!-- HOME -->
                <section id="home" class="view-section active">
                    <h2 id="greeting">Namaskaram</h2>
                    <h3>Telugu Hits (Test Audio Playing) <span class="warning-tag">Working</span></h3>
                    <div class="card-grid" id="trending-cards"></div>
                    <h3>More Songs <span class="warning-tag">Working</span></h3>
                    <div class="card-grid" id="mass-cards"></div>
                </section>

                <!-- SEARCH -->
                <section id="search" class="view-section">
                    <div class="search-wrapper" style="margin: 0 32px 20px 32px;">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" placeholder="Search Telugu Songs..." onkeyup="handleSearch(this.value)">
                    </div>
                    <div id="search-results" style="display: none; padding: 0 32px;">
                        <h3>Results</h3>
                        <div id="search-list"></div>
                    </div>
                    <div id="browse-grid" class="card-grid"></div>
                </section>

                <!-- LIBRARY -->
                <section id="library" class="view-section">
                    <h2 style="padding: 0 32px; margin-bottom:10px;">Your Library</h2>
                    <div class="song-row" style="border-bottom: 1px solid #444; padding: 0 32px 10px 32px; text-transform: uppercase; font-size: 11px;">
                        <div>#</div>
                        <div>Song</div>
                        <div>Album</div>
                        <div style="text-align: right;">Time</div>
                    </div>
                    <div id="library-list"></div>
                </section>
            </main>
        </div>

        <!-- Player Bar -->
        <footer class="player-bar">
            <div class="track-info">
                <div class="track-art">
                    <img id="player-img" src="https://picsum.photos/seed/music/100/100" alt="">
                </div>
                <div>
                    <h4 id="player-title" style="font-size: 14px; margin-bottom: 3px;">Select a song</h4>
                    <p id="player-artist" style="font-size: 11px; color: #b3b3b3;">--</p>
                </div>
            </div>

            <div class="player-controls">
                <div class="control-buttons">
                    <button class="control-btn" onclick="toggleShuffle()"><i class="fas fa-random" id="shuffle-icon"></i></button>
                    <button class="control-btn" onclick="prevSong()"><i class="fas fa-step-backward"></i></button>
                    <button class="btn-play-pause" onclick="togglePlay()">
                        <i class="fas fa-play" id="play-icon"></i>
                    </button>
                    <button class="control-btn" onclick="nextSong()"><i class="fas fa-step-forward"></i></button>
                    <button class="control-btn" onclick="toggleRepeat()"><i class="fas fa-redo" id="repeat-icon"></i></button>
                </div>
                <div class="progress-container">
                    <span id="curr-time">0:00</span>
                    <div class="progress-bar-wrapper" id="progress-wrapper">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <span id="tot-time">0:00</span>
                </div>
            </div>

            <div class="volume-controls">
                <button class="control-btn" onclick="openVideoMode()" title="Watch Video" style="margin-right: 10px; color: var(--primary);">
                    <i class="fas fa-desktop"></i>
                </button>
                <i class="fas fa-volume-up" style="font-size: 14px; color: #b3b3b3;"></i>
                <div class="volume-bar">
                    <div class="volume-fill"></div>
                </div>
            </div>
        </footer>
    </div>

<!-- VIDEO OVERLAY MODAL -->
<div id="video-overlay">
    <button class="btn-close-video" onclick="closeVideoMode()"><i class="fas fa-times"></i></button>
    <div id="video-container">
        <video id="main-video-player" playsinline>
            Your browser does not support the video tag.
        </video>
        <div class="video-controls-bar">
            <button class="video-btn" onclick="toggleVideoPlay()"><i class="fas fa-play" id="video-play-icon"></i></button>
            <span style="color:white; font-size:14px;" id="video-title-display">Song Title</span>
        </div>
    </div>
</div>

<div class="toast" id="toast">Message</div>

<!-- HTML5 AUDIO PLAYER -->
<audio id="audio-player"></audio>

<script>
    // --- UPDATED WORKING SONG DATA ---
    // Using SoundHelix links which are guaranteed to play.
    // The TITLES are Telugu, but the AUDIO is English (for testing).
    // Replace 'src' with your own Telugu MP3 files later.
    
    const songs = [
        { 
            id: 1, 
            title: "Naatu Naatu", 
            artist: "Rahul Sipligunj, Kaala Bhairava", 
            album: "RRR", 
            duration: "6:12", 
            // RELIABLE TEST LINK:
            src: "natu natu.mpeg",
            img: "https://static.toiimg.com/photo/98729466/98729466.jpg",
            added: "Today"
        },
        { 
            id: 2, 
            title: "Samajavaragamana", 
            artist: "Sid Sriram", 
            album: "Ala Vaikunthapurramuloo", 
            duration: "7:05", 
            // RELIABLE TEST LINK:
            src: "samajavaragamana.mpeg", 
            img: "https://m.media-amazon.com/images/M/MV5BZTJiODVkY2MtYjQwMS00ODdhLTkwNWEtZGZjMGNkOGY0MjUwXkEyXkFqcGc@._V1_.jpg",
            added: "Yesterday"
        },
        { 
            id: 3, 
            title: "srivalli", 
            artist: "Indravathi Chauhan", 
            album: "Pushpa", 
            duration: "5:44", 
            // RELIABLE TEST LINK:
            src: "srivalli.mpeg", 
            img: "https://i.ytimg.com/vi/_1BbDhiiV6A/maxresdefault.jpg",
            added: "2 days ago"
        },
        { 
            id: 4, 
            title: "pushapa the rule", 
            artist: "Javed Ali", 
            album: "Pushpa", 
            duration: "4:20", 
            // RELIABLE TEST LINK:
            src: "dhakkko dakko.mpeg",
            img: "https://picsum.photos/seed/srivalli/200/200",
            added: "1 week ago"
        },
        { 
            id: 5, 
            title: "Kalaavathi", 
            artist: "Sid Sriram", 
            album: "Sarkaru Vaari Paata", 
            duration: "4:50", 
            // RELIABLE TEST LINK:
            src: "kalavathi.mpeg", 
            img: "https://i.scdn.co/image/ab67616d0000b273628c64b83f6ff72b9f472699",
            added: "2 weeks ago"
        },
        { 
            id: 6, 
            title: "Dhoom Dhaam", 
            artist: "Ranjith & Dhee", 
            album: "Dasara", 
            duration: "3:50", 
            // RELIABLE TEST LINK:
            src: "dhoom dham.mpeg", 
            img: "https://c.saavncdn.com/427/Dhoom-Dhaam-From-Dasara-Telugu-Telugu-2022-20221002174042-500x500.jpg",
            added: "1 month ago"
        }
    ];

    const playlists = ["Top 50 - Telugu", "Thaman Special", "DSP Hits", "Devi Sri Prasad", "Anirudh Hits", "Classic Melodies"];

    // --- STATE ---
    let currentSongIndex = 0;
    let isPlaying = false;
    let isShuffle = false;
    let isRepeat = false;
    let audio = document.getElementById('audio-player');
    let video = document.getElementById('main-video-player');
    let isVideoMode = false;

    // --- LOGIN LOGIC ---
    function handleLogin(e) {
        e.preventDefault();
        document.getElementById('login-page').style.display = 'none';
        document.getElementById('app-container').style.display = 'flex';
        document.getElementById('user-profile-display').style.display = 'flex';
        initApp();
    }

    function initApp() {
        setGreeting();
        renderPlaylists();
        renderHome();
        renderLibrary();
        renderBrowse();
    }

    // --- RENDER ---
    function setGreeting() {
        const hr = new Date().getHours();
        const el = document.getElementById('greeting');
        if(hr < 12) el.innerText = "Good Morning";
        else if(hr < 18) el.innerText = "Good Afternoon";
        else el.innerText = "Good Evening";
    }

    function renderPlaylists() {
        const div = document.getElementById('playlist-container');
        div.innerHTML = playlists.map(p => `<div class="playlist-item"><i class="fas fa-music" style="font-size:12px; margin-right:8px;"></i> ${p}</div>`).join('');
    }

    function renderHome() {
        const trendDiv = document.getElementById('trending-cards');
        trendDiv.innerHTML = songs.slice(0,4).map(s => createCard(s)).join('');
        const massDiv = document.getElementById('mass-cards');
        massDiv.innerHTML = songs.slice(2,6).map(s => createCard(s)).join('');
    }

    function createCard(song) {
        return `
        <div class="card" onclick="playSong(${song.id})">
            <div class="card-img-wrapper">
                <img src="${song.img}" class="card-img" alt="cover">
                <div class="play-btn-overlay"><i class="fas fa-play"></i></div>
            </div>
            <div class="card-title">${song.title}</div>
            <div class="card-desc">${song.artist}</div>
        </div>`;
    }

    function renderLibrary() {
        const list = document.getElementById('library-list');
        list.innerHTML = songs.map((s, i) => `
            <div class="song-row" onclick="playSong(${s.id})">
                <div>${i+1}</div>
                <div class="song-info">
                    <img src="${s.img}" alt="">
                    <div>
                        <div style="font-weight:bold; color:white;">${s.title}</div>
                        <div style="font-size:12px;">${s.artist}</div>
                    </div>
                </div>
                <div>${s.album}</div>
                <div style="text-align:right;">${s.duration}</div>
            </div>
        `).join('');
    }

    function renderBrowse() {
        const div = document.getElementById('browse-grid');
        const cats = ["Trending", "Mass", "Romance", "Old Classics", "Folk", "DJ Remix", "Devi Sri Prasad", "Thaman S"];
        div.innerHTML = cats.map((c, i) => {
            const colors = ['#e53935', '#ff9f00', '#1e88e5', '#8e24aa', '#43a047', '#00acc1', '#fdd835', '#5e35b1'];
            return `
            <div class="card" style="background-color: ${colors[i%colors.length]}; height: 140px; display:flex; align-items:flex-end; padding: 15px;">
                <h3 style="margin:0; color:white; font-weight:800; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">${c}</h3>
            </div>`;
        }).join('');
    }

    // --- AUDIO LOGIC ---
    function playSong(id) {
        const idx = songs.findIndex(s => s.id === id);
        if(idx !== -1) {
            currentSongIndex = idx;
            loadSong(songs[idx]);
            
            if(isVideoMode) {
                loadVideo(songs[idx]);
                video.play();
            } else {
                audio.play().catch(e => {
                    console.error("Playback failed:", e);
                    showToast("Error playing audio. Check network.");
                });
            }
        }
    }

    function loadSong(song) {
        document.getElementById('player-title').innerText = song.title;
        document.getElementById('player-artist').innerText = song.artist;
        document.getElementById('player-img').src = song.img;
        document.getElementById('tot-time').innerText = song.duration;
        
        if(!isVideoMode) {
            audio.src = song.src;
        }
        
        isPlaying = true;
        updatePlayUI();
    }

    function togglePlay() {
        if(!audio.src && !video.src) {
            playSong(songs[0].id);
            return;
        }

        if(isVideoMode) {
            if(video.paused) {
                video.play();
                isPlaying = true;
            } else {
                video.pause();
                isPlaying = false;
            }
        } else {
            if(isPlaying) audio.pause();
            else audio.play();
            isPlaying = !isPlaying;
        }
        updatePlayUI();
    }

    function updatePlayUI() {
        const icon = document.getElementById('play-icon');
        const vidIcon = document.getElementById('video-play-icon');
        
        icon.className = isPlaying ? 'fas fa-pause' : 'fas fa-play';
        vidIcon.className = isPlaying ? 'fas fa-pause' : 'fas fa-play';
        
        if(isPlaying && !isVideoMode) showToast(`Playing: ${songs[currentSongIndex].title}`);
    }

    function nextSong() {
        if(isShuffle) currentSongIndex = Math.floor(Math.random() * songs.length);
        else currentSongIndex = (currentSongIndex + 1) % songs.length;
        playSong(songs[currentSongIndex].id);
    }

    function prevSong() {
        currentSongIndex = (currentSongIndex - 1 + songs.length) % songs.length;
        playSong(songs[currentSongIndex].id);
    }

    // --- PROGRESS BAR LOGIC ---
    function updateProgress() {
        let current, duration;
        
        if(isVideoMode) {
            current = video.currentTime;
            duration = video.duration;
        } else {
            current = audio.currentTime;
            duration = audio.duration;
        }

        if(isNaN(duration)) return;
        const pct = (current / duration) * 100;
        document.getElementById('progress-fill').style.width = `${pct}%`;
        
        const mins = Math.floor(current/60);
        const secs = Math.floor(current%60);
        document.getElementById('curr-time').innerText = `${mins}:${secs<10?'0':''}${secs}`;
    }

    function setProgress(e) {
        const width = this.clientWidth;
        const clickX = e.offsetX;
        
        let duration = isVideoMode ? video.duration : audio.duration;
        let seekTime = (clickX/width)*duration;
        
        if(isVideoMode) video.currentTime = seekTime;
        else audio.currentTime = seekTime;
    }

    // --- VIDEO MODE LOGIC ---
    function openVideoMode() {
        if(!audio.src && !video.src) return;
        
        const overlay = document.getElementById('video-overlay');
        const song = songs[currentSongIndex];
        
        isVideoMode = true;
        overlay.style.display = 'flex';
        
        const currentTime = audio.currentTime || 0;
        
        loadVideo(song);
        video.currentTime = currentTime;
        
        if(isPlaying) video.play();
        
        document.getElementById('video-title-display').innerText = song.title + " - " + song.artist;
    }

    function closeVideoMode() {
        const overlay = document.getElementById('video-overlay');
        
        if(video) {
            const videoTime = video.currentTime;
            audio.currentTime = videoTime;
            video.pause();
        }
        
        isVideoMode = false;
        overlay.style.display = 'none';
        
        if(isPlaying) audio.play();
    }
    
    function loadVideo(song) {
        video.src = song.videoSrc;
    }
    
    function toggleVideoPlay() {
        if(video.paused) video.play();
        else video.pause();
        isPlaying = !video.paused;
        updatePlayUI();
    }

    // --- UTILS ---
    function navigate(id) {
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        event.currentTarget.classList.add('active');
        document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function toggleShuffle() {
        isShuffle = !isShuffle;
        document.getElementById('shuffle-icon').style.color = isShuffle ? '#ff9f00' : '#b3b3b3';
        showToast(isShuffle ? "Shuffle On" : "Shuffle Off");
    }

    function toggleRepeat() {
        isRepeat = !isRepeat;
        audio.loop = isRepeat;
        video.loop = isRepeat;
        document.getElementById('repeat-icon').style.color = isRepeat ? '#ff9f00' : '#b3b3b3';
        showToast(isRepeat ? "Repeat On" : "Repeat Off");
    }

    function handleSearch(val) {
        const resultsDiv = document.getElementById('search-results');
        const listDiv = document.getElementById('search-list');
        const browseDiv = document.getElementById('browse-grid');

        if(val.length > 0) {
            browseDiv.style.display = 'none';
            resultsDiv.style.display = 'block';
            const hits = songs.filter(s => s.title.toLowerCase().includes(val.toLowerCase()));
            
            listDiv.innerHTML = hits.length ? hits.map(s => `
                <div class="song-row" onclick="playSong(${s.id})">
                    <div class="song-info">
                        <img src="${s.img}">
                        <div>
                            <div style="font-weight:bold; color:white;">${s.title}</div>
                            <div style="font-size:12px;">${s.artist}</div>
                        </div>
                    </div>
                    <div style="text-align:right;">${s.duration}</div>
                </div>
            `).join('') : '<div style="padding:20px; color:#777;">No songs found</div>';
        } else {
            browseDiv.style.display = 'grid';
            resultsDiv.style.display = 'none';
        }
    }

    function showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
    }

    // --- EVENTS ---
    audio.addEventListener('timeupdate', updateProgress);
    audio.addEventListener('ended', nextSong);
    video.addEventListener('timeupdate', updateProgress);
    video.addEventListener('ended', nextSong);
    
    document.getElementById('progress-wrapper').addEventListener('click', setProgress);

</script>
</body>

</html>
